class_name GameTileMap
extends TileMapLayer


signal placed(node: Node2D)


@onready var preview_sprite: Sprite2D = $PreviewSprite


@export var placeables: Array[PackedScene]
@export var _preview_amplitude: float = 10.0
@export var _preview_period: float = 1.0
@export var _preview_base_alpha: float = 80


var _selected_placeable_idx: int = 0
var _selected_placeable: Node2D
var _preview_time: float = 0.0


func _process(_delta: float) -> void:
	var mouse_pos := get_local_mouse_position()
	var aligned_pos := map_to_local(local_to_map(mouse_pos))
	preview_sprite.position = aligned_pos

	if _selected_placeable == null:
		_create_temp_instance()

	if Input.is_action_just_pressed("place"):
		_selected_placeable.global_position = to_global(aligned_pos)
		get_parent().add_child(_selected_placeable)
		_create_temp_instance()

	_preview_time += _delta
	
	if _preview_time >= _preview_time
	
	
	
func _create_temp_instance() -> void:
	var selected_scene := placeables[_selected_placeable_idx]

	_selected_placeable = selected_scene.instantiate()	
	var sprite: Sprite2D = _selected_placeable.get_node("Sprite2D")
	preview_sprite.texture = sprite.texture
